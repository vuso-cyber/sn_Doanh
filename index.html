<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ch√∫c m·ª´ng sinh nh·∫≠t Doanh üéâ</title>
    <style>
      :root {
        --bg: #0b1020;
        --card: #111827;
        --accent: #ff6b81;
        --text: #fff;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, Segoe UI, Roboto;
        background: linear-gradient(180deg, #061022, #0b1020);
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }
      .card {
        width: 360px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.02)
        );
        padding: 18px;
        border-radius: 14px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
        position: relative;
      }
      h1 {
        margin: 0 0 6px 0;
        font-size: 20px;
      }
      p.lead {
        margin: 0;
        color: #dfe7f3;
      }
      .big {
        font-size: 36px;
        font-weight: 800;
        color: var(--accent);
        margin-top: 10px;
      }
      .count {
        margin-top: 12px;
        font-weight: 700;
      }
      .controls {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }
      button {
        padding: 8px 12px;
        border-radius: 8px;
        border: 0;
        cursor: pointer;
        background: var(--accent);
        color: #140012;
        font-weight: 700;
      }
      input[type="text"] {
        width: 100%;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #ffffff14;
        background: transparent;
        color: var(--text);
      }
      form {
        margin-top: 12px;
        display: flex;
        gap: 8px;
        flex-direction: column;
      }
      canvas#confetti {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="card" role="main" aria-label="Sinh nh·∫≠t Doanh">
      <canvas id="confetti"></canvas>
      <h1>Ch√∫c m·ª´ng sinh nh·∫≠t <span id="name">Doanh</span> üéâ</h1>
      <p class="lead">Sinh ng√†y: <strong id="dob">15/08/2003</strong></p>
      <div class="big" id="age">--</div>
      <div class="count" id="countdown">-- ng√†y --:--:--</div>

      <div class="controls">
        <button id="burst">Tung confetti</button>
        <button id="apiGreet">G·ª≠i l·ªùi ch√∫c l√™n server</button>
      </div>

      <form id="greetForm">
        <input type="text" id="fromName" placeholder="T√™n b·∫°n" />
        <input
          type="text"
          id="message"
          placeholder="L·ªùi ch√∫c (v√≠ d·ª•: Ch√∫c Doanh lu√¥n vui v·∫ª!)"
        />
        <button type="submit">G·ª≠i</button>
      </form>

      <div id="response" style="margin-top: 10px; color: #c9f5d3"></div>
    </div>

    <script>
      (function(){
        const dobStr = '2003-08-15'; // ƒë·ªïi n·∫øu c·∫ßn (YYYY-MM-DD)
        document.getElementById('dob').textContent = new Date(dobStr).toLocaleDateString();
        const name = 'Doanh';
        document.getElementById('name').textContent = name;

        function calcAge(dob){
          const b = new Date(dob);
          const now = new Date();
          let age = now.getFullYear() - b.getFullYear();
          const thisYearB = new Date(now.getFullYear(), b.getMonth(), b.getDate());
          if (now < thisYearB) age--;
          return age;
        }

        function nextBirthday(dob){
          const b = new Date(dob);
          const now = new Date();
          let next = new Date(now.getFullYear(), b.getMonth(), b.getDate());
          if (now > next) next = new Date(now.getFullYear()+1, b.getMonth(), b.getDate());
          return next;
        }

        function updateCountdown(){
          const next = nextBirthday(dobStr);
          const now = new Date();
          const diff = next - now;
          const days = Math.floor(diff / (1000*60*60*24));
          let rem = Math.floor(diff/1000) % (24*3600);
          const hh = String(Math.floor(rem/3600)).padStart(2,'0');
          rem = rem % 3600;
          const mm = String(Math.floor(rem/60)).padStart(2,'0');
          const ss = String(rem%60).padStart(2,'0');
          document.getElementById('countdown').textContent = ${days} ng√†y ${hh}:${mm}:${ss};
        }

        document.getElementById('age').textContent = ${calcAge(dobStr)} tu·ªïi;
        updateCountdown();
        setInterval(()=>{ document.getElementById('age').textContent = ${calcAge(dobStr)} tu·ªïi; updateCountdown(); },1000);

        // simple confetti
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        function resize(){ canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight; }
        resize(); window.addEventListener('resize', resize);
        const parts = [];
        function burst(n=80){
          for(let i=0;i<n;i++){
            parts.push({
              x: Math.random()*canvas.width,
              y: Math.random()*canvas.height*0.2,
              vx: (Math.random()-0.5)*6,
              vy: Math.random()*6+2,
              s: Math.random()*8+4,
              c: hsl(${Math.random()*360},80%,60%),
              life: Math.random()*60+60
            });
          }
        }
        function tick(){
          ctx.clearRect(0,0,canvas.width,canvas.height);
          for(let i=parts.length-1;i>=0;i--){
            const p = parts[i];
            p.x += p.vx; p.y += p.vy; p.vy += 0.12; p.life--;
            ctx.fillStyle = p.c; ctx.fillRect(p.x,p.y,p.s,p.s*0.6);
            if (p.life<=0 || p.y>canvas.height+50) parts.splice(i,1);
          }
          requestAnimationFrame(tick);
        }
        tick();

        document.getElementById('burst').addEventListener('click', ()=> burst(120));

        // sending greeting to backend (sample endpoints)
        const API_URL = ''; // n·∫øu d√πng: 'http://localhost:5000' (Python Flask) ho·∫∑c 'http://localhost/save_greeting.php' (PHP)
        document.getElementById('greetForm').addEventListener('submit', async (e)=>{
          e.preventDefault();
          const from = document.getElementById('fromName').value || 'B·∫°n';
          const message = document.getElementById('message').value || Ch√∫c ${name} sinh nh·∫≠t vui v·∫ª!;
          document.getElementById('response').textContent = 'ƒêang g·ª≠i...';
          try {
            if (!API_URL) {
              // ch·ªâ m√¥ ph·ªèng local n·∫øu kh√¥ng c√≥ backend
              document.getElementById('response').textContent = G·ª≠i th√†nh c√¥ng (m√¥ ph·ªèng): "${message}" t·ª´ ${from};
              burst(80);
              return;
            }
            const res = await fetch(API_URL + '/greetings', {
              method: 'POST',
              headers: {'Content-Type':'application/json'},
              body: JSON.stringify({to:name, from, message})
            });
            const data = await res.json();
            document.getElementById('response').textContent = data.status || JSON.stringify(data);
            burst(80);
          } catch(err){
            document.getElementById('response').textContent = 'L·ªói khi g·ª≠i: '+err.message;
          }
        });

        // sample button to call greet API
        document.getElementById('apiGreet').addEventListener('click', async ()=>{
          const API = API_URL || '';
          if (!API) { alert('Kh√¥ng c√≥ API_URL. M√£ frontend ƒëang ch·∫°y ·ªü ch·∫ø ƒë·ªô offline.'); return; }
          try {
            const r = await fetch(API + '/say_hello?name=' + encodeURIComponent(name));
            const j = await r.json();
            alert('Server: '+ (j.message || JSON.stringify(j)));
          } catch(err){ alert('L·ªói g·ªçi API: '+err) }
        });

      })();
    </script>
  </body>
</html>
